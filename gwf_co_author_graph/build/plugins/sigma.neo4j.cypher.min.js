!function(e){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.neo4j"),sigma.utils.pkg("sigma.utils"),sigma.neo4j.send=function(e,t,a,n,s){var o,i,r=sigma.utils.xhr(),d=e;if("object"==typeof e&&(d=e.url,o=e.user,i=e.password),!r)throw"XMLHttpRequest not supported, cannot load the file.";r.open(a,d+=t,!0),o&&i&&r.setRequestHeader("Authorization","Basic "+btoa(o+":"+i)),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Content-type","application/json; charset=utf-8"),r.onreadystatechange=function(){4===r.readyState&&s(JSON.parse(r.responseText))},r.send(n)},sigma.neo4j.cypher_parse=function(e){var t,a={nodes:[],edges:[]},n={},s={};for(t in e.results[0].data.forEach(function(e){e.graph.nodes.forEach(function(e){e={id:e.id,label:e.id,x:Math.random(),y:Math.random(),size:1,color:"#000000",neo4j_labels:e.labels,neo4j_data:e.properties};e.id in n||(n[e.id]=e)}),e.graph.relationships.forEach(function(e){e={id:e.id,label:e.type,source:e.startNode,target:e.endNode,color:"#7D7C8E",neo4j_type:e.type,neo4j_data:e.properties};e.id in s||(s[e.id]=e)})}),n)a.nodes.push(n[t]);for(t in s)a.edges.push(s[t]);return a},sigma.neo4j.cypher=function(e,t,n,a){var s=JSON.stringify({statements:[{statement:t,resultDataContents:["graph"],includeStats:!1}]}),t=function(a){return function(e){var t=sigma.neo4j.cypher_parse(e);n instanceof sigma?(n.graph.clear(),n.graph.read(t)):"object"==typeof n?((n=new sigma(n)).graph.read(t),n.refresh()):"function"==typeof n&&(a=n,n=null),a&&a(n||t)}};sigma.neo4j.send(e,"/db/data/transaction/commit","POST",s,t(a))},sigma.neo4j.getLabels=function(e,t){sigma.neo4j.send(e,"/db/data/labels","GET",null,t)},sigma.neo4j.getTypes=function(e,t){sigma.neo4j.send(e,"/db/data/relationship/types","GET",null,t)}}.call(this);